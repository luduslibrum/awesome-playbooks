{
  "name" : "Detonate Malware In McAfee ATD",
  "type" : "Standard",
  "panX" : 311.0,
  "panY" : 20.0,
  "logLevel" : "WARN",
  "description" : "This Playbook will trigger when a malware document is tagged with \"atd_submit\". The malware will be submitted to McAfee ATD for detonation, then the Playbook will ingest the submissions results. Depending on the severity that McAfee reports, the three file hash algorithms will be ingested with varying rating levels.",
  "version" : "1.0",
  "jobList" : [ {
    "id" : 122,
    "appCatalogItem" : {
      "programName" : "TCPB - McAfeeDetonateFile v1.0",
      "displayName" : "Analyze File with McAfee ATD",
      "programVersion" : "1.0.6"
    },
    "name" : "Analyze File with McAfee ATD 1",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "file_name"
      },
      "value" : "#App:124:tc.document.file_name!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "filePriorityQ"
      },
      "value" : "run_now"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "mcafee_api_username"
      },
      "value" : "${ORGANIZATION:TEXT:McAfee ATD API Username}"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "mcafee_host"
      },
      "value" : "${ORGANIZATION:TEXT:McAfee ATD Hostname}"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "file_content"
      },
      "value" : "#App:124:tc.document.file_data!Binary"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "analyzeAgain"
      },
      "value" : "false"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "zip_password"
      },
      "value" : "TCinfected"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "mcafee_api_password"
      },
      "value" : "${ORGANIZATION:KEYCHAIN:McAfee ATD API Password}"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "vmProfileList"
      },
      "value" : ""
    } ],
    "locationLeft" : 280.0,
    "locationTop" : 140.0
  }, {
    "id" : 123,
    "appCatalogItem" : {
      "programName" : "TCPB - McAfeeShowReport v1.0",
      "displayName" : "Get McAfee ATD Report",
      "programVersion" : "1.0.6"
    },
    "name" : "Get McAfee ATD Report",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "taskid_or_md5"
      },
      "value" : "#App:122:mcafee.atd.submit.taskId!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "mcafee_api_password"
      },
      "value" : "${ORGANIZATION:KEYCHAIN:McAfee ATD API Password}"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "mcafee_host"
      },
      "value" : "${ORGANIZATION:TEXT:McAfee ATD Hostname}"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "mcafee_api_username"
      },
      "value" : "${ORGANIZATION:TEXT:McAfee ATD API Username}"
    } ],
    "locationLeft" : 280.0,
    "locationTop" : 250.0,
    "playbookRetryEnabled" : true,
    "playbookRetryDelayMinutes" : 5,
    "playbookRetryMaxRetries" : 12
  }, {
    "id" : 124,
    "appCatalogItem" : {
      "programName" : "TCPB - DocumentRetrieveById v1.0",
      "displayName" : "Get ThreatConnect Document by ID",
      "programVersion" : "1.0.23"
    },
    "name" : "Instantiate Malware Sample",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "resource_type"
      },
      "value" : "Document"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "ids"
      },
      "value" : "#Trigger:8:trg.tc.entity!TCEntity"
    } ],
    "locationLeft" : -30.0,
    "locationTop" : 250.0
  }, {
    "id" : 125,
    "appCatalogItem" : {
      "programName" : "TCPB - FileCreate v1.1",
      "displayName" : "Create ThreatConnect File",
      "programVersion" : "1.1.19"
    },
    "name" : "Store File Hashes (5 Skulls)",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "confidence"
      },
      "value" : ""
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "fail_on_error"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "attributes_all"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "resource_type"
      },
      "value" : "File"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "sha256"
      },
      "value" : "#App:123:mcafee.atd.report.subject.sha256!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "occurrence_date"
      },
      "value" : ""
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "labels_all"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "associations"
      },
      "value" : "#App:124:tc.document!TCEntity"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "labels"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "tags"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "attributes"
      },
      "value" : "[]"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "occurrence_path"
      },
      "value" : ""
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "sha1"
      },
      "value" : "#App:123:mcafee.atd.report.subject.sha1!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "file_size"
      },
      "value" : "#App:124:tc.document.file_size!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "owner"
      },
      "value" : "Cody"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "occurrence_name"
      },
      "value" : ""
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "rating"
      },
      "value" : "5"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "tags_all"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "resource_name"
      },
      "value" : "#App:123:mcafee.atd.report.subject.md5!String"
    } ],
    "locationLeft" : 800.0,
    "locationTop" : 110.0
  }, {
    "id" : 126,
    "appCatalogItem" : {
      "programName" : "If / Else",
      "displayName" : "If / Else",
      "programVersion" : "1.0.0"
    },
    "name" : "Severity 5",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "operator"
      },
      "value" : "equals"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "match_case"
      },
      "value" : "false"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "as_numeric"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "operand_2"
      },
      "value" : "5"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "operand_1"
      },
      "value" : "#App:123:mcafee.atd.report.verdict.severity!String"
    } ],
    "locationLeft" : 650.0,
    "locationTop" : 130.0
  }, {
    "id" : 127,
    "appCatalogItem" : {
      "programName" : "TCPB - FileCreate v1.1",
      "displayName" : "Create ThreatConnect File",
      "programVersion" : "1.1.19"
    },
    "name" : "Store File Hashes (5 Skulls) 2",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "resource_name"
      },
      "value" : "#App:123:mcafee.atd.report.subject.md5!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "attributes"
      },
      "value" : "[]"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "resource_type"
      },
      "value" : "File"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "attributes_all"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "sha1"
      },
      "value" : "#App:123:mcafee.atd.report.subject.sha1!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "confidence"
      },
      "value" : ""
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "tags_all"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "fail_on_error"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "occurrence_name"
      },
      "value" : ""
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "associations"
      },
      "value" : "#App:124:tc.document!TCEntity"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "owner"
      },
      "value" : "Cody"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "sha256"
      },
      "value" : "#App:123:mcafee.atd.report.subject.sha256!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "tags"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "occurrence_path"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "rating"
      },
      "value" : "5"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "labels"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "labels_all"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "file_size"
      },
      "value" : "#App:124:tc.document.file_size!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "occurrence_date"
      }
    } ],
    "locationLeft" : 800.0,
    "locationTop" : 300.0
  }, {
    "id" : 128,
    "appCatalogItem" : {
      "programName" : "TCPB - FileCreate v1.1",
      "displayName" : "Create ThreatConnect File",
      "programVersion" : "1.1.19"
    },
    "name" : "Store File Hashes (3 Skulls)",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "occurrence_name"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "occurrence_date"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "tags_all"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "confidence"
      },
      "value" : ""
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "associations"
      },
      "value" : "#App:124:tc.document!TCEntity"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "owner"
      },
      "value" : "Cody"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "fail_on_error"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "labels"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "tags"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "labels_all"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "file_size"
      },
      "value" : "#App:124:tc.document.file_size!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "attributes"
      },
      "value" : "[]"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "sha256"
      },
      "value" : "#App:123:mcafee.atd.report.subject.sha256!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "occurrence_path"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "attributes_all"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "rating"
      },
      "value" : "3"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "resource_name"
      },
      "value" : "#App:123:mcafee.atd.report.subject.md5!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "sha1"
      },
      "value" : "#App:123:mcafee.atd.report.subject.sha1!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "resource_type"
      },
      "value" : "File"
    } ],
    "locationLeft" : 800.0,
    "locationTop" : 450.0
  }, {
    "id" : 129,
    "appCatalogItem" : {
      "programName" : "If / Else",
      "displayName" : "If / Else",
      "programVersion" : "1.0.0"
    },
    "name" : "High Severity",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "operand_2"
      },
      "value" : "high"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "match_case"
      },
      "value" : "false"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "operand_1"
      },
      "value" : "#App:123:mcafee.atd.report.verdict.severity!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "as_numeric"
      },
      "value" : "false"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "operator"
      },
      "value" : "equals"
    } ],
    "locationLeft" : 650.0,
    "locationTop" : 300.0
  }, {
    "id" : 130,
    "appCatalogItem" : {
      "programName" : "If / Else",
      "displayName" : "If / Else",
      "programVersion" : "1.0.0"
    },
    "name" : "Medium Severity",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "operand_1"
      },
      "value" : "#App:123:mcafee.atd.report.verdict.severity!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "as_numeric"
      },
      "value" : "false"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "operator"
      },
      "value" : "equals"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "operand_2"
      },
      "value" : "Medium"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "match_case"
      },
      "value" : "false"
    } ],
    "locationLeft" : 650.0,
    "locationTop" : 480.0
  }, {
    "id" : 131,
    "appCatalogItem" : {
      "programName" : "TCPB - FileCreate v1.1",
      "displayName" : "Create ThreatConnect File",
      "programVersion" : "1.1.19"
    },
    "name" : "Store File Hashes (1 Skull)",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "tags"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "associations"
      },
      "value" : "#App:124:tc.document!TCEntity"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "confidence"
      },
      "value" : ""
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "resource_name"
      },
      "value" : "#App:123:mcafee.atd.report.subject.md5!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "attributes"
      },
      "value" : "[]"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "rating"
      },
      "value" : "1"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "attributes_all"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "labels_all"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "occurrence_date"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "fail_on_error"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "sha256"
      },
      "value" : "#App:123:mcafee.atd.report.subject.sha256!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "resource_type"
      },
      "value" : "File"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "file_size"
      },
      "value" : "#App:123:mcafee.atd.report.files.md5!StringArray"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "sha1"
      },
      "value" : "#App:123:mcafee.atd.report.subject.sha1!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "labels"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "occurrence_name"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "tags_all"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "owner"
      },
      "value" : "Cody"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "occurrence_path"
      }
    } ],
    "locationLeft" : 800.0,
    "locationTop" : 570.0
  }, {
    "id" : 13867,
    "appCatalogItem" : {
      "programName" : "TCPB - SetVariable v1.0",
      "displayName" : "Set Variable",
      "programVersion" : "1.0.13"
    },
    "name" : "Error getting submission results.",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "variable_mapping"
      },
      "value" : "[{\"key\":\"results.error\",\"value\":\"Error getting submission results. Please see log for more details.\"}]"
    } ],
    "locationLeft" : 280.0,
    "locationTop" : 370.0
  }, {
    "id" : 13868,
    "appCatalogItem" : {
      "programName" : "TCPB - SetVariable v1.0",
      "displayName" : "Set Variable",
      "programVersion" : "1.0.13"
    },
    "name" : "Error instantiating malware sample results.",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "variable_mapping"
      },
      "value" : "[{\"key\":\"sample.error\",\"value\":\"Error instantiating malware sample results. Please see log for more details.\"}]"
    } ],
    "locationLeft" : -30.0,
    "locationTop" : 370.0
  } ],
  "playbookConnectionList" : [ {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 122,
    "targetJobId" : 123
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "targetJobId" : 124,
    "sourceTriggerId" : 8
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 124,
    "targetJobId" : 122
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 123,
    "targetJobId" : 126
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 126,
    "targetJobId" : 125
  }, {
    "type" : "Fail",
    "isCircularOnTarget" : false,
    "sourceJobId" : 126,
    "targetJobId" : 129
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 129,
    "targetJobId" : 127
  }, {
    "type" : "Fail",
    "isCircularOnTarget" : false,
    "sourceJobId" : 129,
    "targetJobId" : 130
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 130,
    "targetJobId" : 128
  }, {
    "type" : "Fail",
    "isCircularOnTarget" : false,
    "sourceJobId" : 130,
    "targetJobId" : 131
  }, {
    "type" : "Fail",
    "isCircularOnTarget" : false,
    "sourceJobId" : 123,
    "targetJobId" : 13867
  }, {
    "type" : "Fail",
    "isCircularOnTarget" : false,
    "sourceJobId" : 124,
    "targetJobId" : 13868
  } ],
  "playbookTriggerList" : [ {
    "id" : 8,
    "name" : "Malware Tagged \"atd_submit\"",
    "type" : "Document",
    "eventType" : "AddTag",
    "locationLeft" : -30.0,
    "locationTop" : 140.0,
    "playbookTriggerFilterList" : [ {
      "fieldType" : "Tag",
      "operatorType" : "Equals",
      "value" : "atd_submit"
    } ],
    "outputVariables" : "[{\"name\":\"trg.tc.entity\",\"type\":\"TCEntity\"}]"
  } ],
  "playbookLabels" : [ {
    "playbookLabelType" : {
      "label" : "Malware"
    }
  }, {
    "playbookLabelType" : {
      "label" : "McAfee"
    }
  }, {
    "playbookLabelType" : {
      "label" : "Sandbox"
    }
  }, {
    "playbookLabelType" : {
      "label" : "ATD"
    }
  } ],
  "exportablePipes" : [ ]
}