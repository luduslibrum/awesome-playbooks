{
  "name" : "VMRay Submission",
  "type" : "Standard",
  "panX" : -852.0,
  "panY" : 150.0,
  "logLevel" : "TRACE",
  "description" : "",
  "jobList" : [ {
    "id" : 800,
    "appCatalogItem" : {
      "programName" : "TCPB - HTTP Client v2.0",
      "displayName" : "HTTP Client",
      "programVersion" : "2.0.8"
    },
    "name" : "Submit to VMRay",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "advanced"
      },
      "value" : "[]"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "multipart"
      },
      "value" : "[{\"key\":\"sample_file\",\"value\":\"#App:801:tc.document.file_data!Binary\"}]"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "url"
      },
      "value" : "https://cloud.vmray.com/rest/sample/submit"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "body"
      },
      "value" : ""
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "headers"
      },
      "value" : "[{\"key\":\"Authorization\",\"value\":\"api_key ${ORGANIZATION:KEYCHAIN:VMRay API Key}\"}]"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "verify_ssl"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "params"
      },
      "value" : "[{\"key\":\"archive_password\",\"value\":\"#App:801:tc.document.archive_password!String\"},{\"key\":\"max_jobs\",\"value\":\"#App:802:vmr.max_jobs!String\"},{\"key\":\"reanalyze\",\"value\":\"#App:802:vmr.reanalyze!String\"},{\"key\":\"shareable\",\"value\":\"#App:804:tlp.share!String\"}]"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "http_method"
      },
      "value" : "POST"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "fail_on_error"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "proxies_enabled"
      },
      "value" : "false"
    } ],
    "locationLeft" : 820.0,
    "locationTop" : 130.0,
    "outputVariables" : "[{\"name\":\"http.content\",\"type\":\"String\"}]",
    "playbookRetryDelayMinutes" : 1,
    "playbookRetryMaxRetries" : 5
  }, {
    "id" : 801,
    "appCatalogItem" : {
      "programName" : "TCPB - DocumentRetrieveById v1.0",
      "displayName" : "Get ThreatConnect Document by ID",
      "programVersion" : "1.0.22"
    },
    "name" : "Get Malware Sample",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "resource_type"
      },
      "value" : "Document"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "ids"
      },
      "value" : "#Trigger:67:trg.action.entity!TCEntity"
    } ],
    "locationLeft" : 380.0,
    "locationTop" : 130.0,
    "outputVariables" : "[{\"name\":\"tc.document.archive_password\",\"type\":\"String\"},{\"name\":\"tc.document.file_data\",\"type\":\"Binary\"},{\"name\":\"tc.document.security_labels\",\"type\":\"StringArray\"}]",
    "playbookRetryDelayMinutes" : 5,
    "playbookRetryMaxRetries" : 12
  }, {
    "id" : 802,
    "appCatalogItem" : {
      "programName" : "TCPB - SetVariable v1.0",
      "displayName" : "Set Variable",
      "programVersion" : "1.0.12"
    },
    "name" : "Set Optional Parameters",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "variable_mapping"
      },
      "value" : "[{\"key\":\"vmr.max_jobs\",\"value\":\"4\"},{\"key\":\"vmr.reanalyze\",\"value\":\"true\"}]"
    } ],
    "locationLeft" : 160.0,
    "locationTop" : 130.0,
    "outputVariables" : "[{\"name\":\"vmr.max_jobs\",\"type\":\"String\"},{\"name\":\"vmr.reanalyze\",\"type\":\"String\"}]"
  }, {
    "id" : 803,
    "appCatalogItem" : {
      "programName" : "DataStore",
      "displayName" : "DataStore",
      "programVersion" : "1.0.0"
    },
    "name" : "Store Results",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "domain_type"
      },
      "value" : "Organization"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "db_method"
      },
      "value" : "POST"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "organization_name"
      },
      "value" : "Customer Org"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "path"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "request_entity"
      },
      "value" : "#App:800:http.content!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "type_name"
      },
      "value" : "vmray-submissions"
    } ],
    "locationLeft" : 1050.0,
    "locationTop" : 200.0
  }, {
    "id" : 804,
    "appCatalogItem" : {
      "programName" : "TCPB - JMESPath v2.0",
      "displayName" : "JMESPath",
      "programVersion" : "2.0.1"
    },
    "name" : "Check Security Labels",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "string_expressions"
      },
      "value" : "[{\"key\":\"tlp.share\",\"value\":\"!(contains(@, \\u0027TLP:AMBER\\u0027) || contains(@, \\u0027TLP:RED\\u0027))\"}]"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "json_data"
      },
      "value" : "#App:801:tc.document.security_labels!StringArray"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "string_array_expressions"
      },
      "value" : "[]"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "strip_quotes"
      },
      "value" : "true"
    } ],
    "locationLeft" : 600.0,
    "locationTop" : 130.0,
    "outputVariables" : "[{\"name\":\"tlp.share\",\"type\":\"String\"}]"
  }, {
    "id" : 805,
    "appCatalogItem" : {
      "programName" : "TCPB - JMESPath v2.0",
      "displayName" : "JMESPath",
      "programVersion" : "2.0.1"
    },
    "name" : "Parse VMRay Portal Data",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "json_data"
      },
      "value" : "#App:800:http.content!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "string_array_expressions"
      },
      "value" : "[]"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "string_expressions"
      },
      "value" : "[{\"key\":\"vmrayWebLink\",\"value\":\"data.samples[0].sample_webif_url\"},{\"key\":\"sha1\",\"value\":\"data.samples[0].sample_sha1hash\"},{\"key\":\"md5\",\"value\":\"data.samples[0].sample_md5hash\"},{\"key\":\"sha256\",\"value\":\"data.samples[0].sample_sha256hash\"},{\"key\":\"ssdeep\",\"value\":\"data.samples[0].sample_ssdeephash\"},{\"key\":\"filename\",\"value\":\"data.samples[0].submission_filename\"},{\"key\":\"fileSize\",\"value\":\"data.samples[0].sample_filesize\"},{\"key\":\"submissionID\",\"value\":\"data.jobs[0].job_submission_id\"},{\"key\":\"vmraySampleID\",\"value\":\"data.jobs[0].job_sample_id\"}]"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "strip_quotes"
      },
      "value" : "true"
    } ],
    "locationLeft" : 1290.0,
    "locationTop" : 160.0
  }, {
    "id" : 806,
    "appCatalogItem" : {
      "programName" : "TCPB - JsonPath v1.0",
      "displayName" : "Json Path",
      "programVersion" : "2.0.6"
    },
    "name" : "Parse Errors",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "column_mapping_as_string"
      },
      "value" : "[{\"key\":\"vmr.error\",\"value\":\"$.data.errors[0].error_msg\"}]"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "json_content"
      },
      "value" : "#App:800:http.content!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "column_mapping"
      },
      "value" : "[]"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "null_missing_leaf"
      },
      "value" : "true"
    } ],
    "locationLeft" : 1060.0,
    "locationTop" : 80.0,
    "outputVariables" : "[{\"name\":\"vmr.error\",\"type\":\"String\"}]"
  }, {
    "id" : 807,
    "appCatalogItem" : {
      "programName" : "Merge",
      "displayName" : "Merge",
      "programVersion" : "1.0.0"
    },
    "name" : "Merge Result",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "output_array"
      },
      "value" : "[{\"key\":\"message\",\"value\":\"#App:808:success!String\"},{\"key\":\"message\",\"value\":\"#App:809:error!String\"}]"
    } ],
    "locationLeft" : 1800.0,
    "locationTop" : 110.0,
    "outputVariables" : "[{\"name\":\"message\",\"type\":\"String\"}]"
  }, {
    "id" : 808,
    "appCatalogItem" : {
      "programName" : "TCPB - SetVariable v1.0",
      "displayName" : "Set Variable",
      "programVersion" : "1.0.12"
    },
    "name" : "Set Success Message",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "variable_mapping"
      },
      "value" : "[{\"key\":\"success\",\"value\":\"\\u003ca href\\u003d\\\"#App:805:vmr.link!String\\\"\\u003eSample Submitted\\u003c/a\\u003e\"}]"
    } ],
    "locationLeft" : 1510.0,
    "locationTop" : 160.0,
    "outputVariables" : "[{\"name\":\"success\",\"type\":\"String\"}]"
  }, {
    "id" : 809,
    "appCatalogItem" : {
      "programName" : "TCPB - SetVariable v1.0",
      "displayName" : "Set Variable",
      "programVersion" : "1.0.12"
    },
    "name" : "Set Error Message",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "variable_mapping"
      },
      "value" : "[{\"key\":\"error\",\"value\":\"Error: #App:806:vmr.error!String\"}]"
    } ],
    "locationLeft" : 1510.0,
    "locationTop" : 60.0,
    "outputVariables" : "[{\"name\":\"error\",\"type\":\"String\"}]"
  }, {
    "id" : 812,
    "appCatalogItem" : {
      "programName" : "TCPB - FileCreate v1.1",
      "displayName" : "Create ThreatConnect File",
      "programVersion" : "1.1.19"
    },
    "name" : "Create ThreatConnect File",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "fail_on_error"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "sha1"
      },
      "value" : "#App:805:sha1!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "resource_name"
      },
      "value" : "#App:805:md5!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "associations"
      },
      "value" : "#Trigger:67:trg.action.entity!TCEntity"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "attributes"
      },
      "value" : "[]"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "tags_all"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "rating"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "resource_type"
      },
      "value" : "File"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "file_size"
      },
      "value" : "#App:805:fileSize!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "labels_all"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "occurrence_path"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "confidence"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "occurrence_date"
      },
      "value" : ""
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "tags"
      }
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "attributes_all"
      },
      "value" : "true"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "owner"
      },
      "value" : "Customer Org"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "occurrence_name"
      },
      "value" : "#App:805:filename!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "sha256"
      },
      "value" : "#App:805:sha256!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "labels"
      }
    } ],
    "locationLeft" : 1510.0,
    "locationTop" : 250.0
  }, {
    "id" : 814,
    "appCatalogItem" : {
      "programName" : "Add Attribute",
      "displayName" : "Create ThreatConnect Attribute",
      "programVersion" : "1.0.0"
    },
    "name" : "Add VMray Sample ID",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "indicator_name"
      },
      "value" : "#Trigger:67:trg.action.entity!TCEntity"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "update"
      },
      "value" : "false"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "attribute_type"
      },
      "value" : "VMRay Sample ID"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "attribute_content"
      },
      "value" : "#App:805:vmraySampleID!String"
    } ],
    "locationLeft" : 1750.0,
    "locationTop" : 250.0
  }, {
    "id" : 815,
    "appCatalogItem" : {
      "programName" : "Add Attribute",
      "displayName" : "Create ThreatConnect Attribute",
      "programVersion" : "1.0.0"
    },
    "name" : "Add VMRay Submission ID",
    "jobParameterList" : [ {
      "appCatalogItemParameter" : {
        "paramName" : "update"
      },
      "value" : "false"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "attribute_content"
      },
      "value" : "#App:805:submissionID!String"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "attribute_type"
      },
      "value" : "VMRay Submission ID"
    }, {
      "appCatalogItemParameter" : {
        "paramName" : "indicator_name"
      },
      "value" : "#Trigger:67:trg.action.entity!TCEntity"
    } ],
    "locationLeft" : 1750.0,
    "locationTop" : 330.0
  } ],
  "playbookConnectionList" : [ {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "targetJobId" : 802,
    "sourceTriggerId" : 67
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 802,
    "targetJobId" : 801
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 800,
    "targetJobId" : 803
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 801,
    "targetJobId" : 804
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 804,
    "targetJobId" : 800
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 800,
    "targetJobId" : 806
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 805,
    "targetJobId" : 808
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 808,
    "targetJobId" : 807
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : true,
    "sourceJobId" : 807,
    "targetTriggerId" : 67
  }, {
    "type" : "Fail",
    "isCircularOnTarget" : false,
    "sourceJobId" : 806,
    "targetJobId" : 805
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 806,
    "targetJobId" : 809
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 809,
    "targetJobId" : 807
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 805,
    "targetJobId" : 812
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 808,
    "targetJobId" : 814
  }, {
    "type" : "Pass",
    "isCircularOnTarget" : false,
    "sourceJobId" : 808,
    "targetJobId" : 815
  } ],
  "playbookTriggerList" : [ {
    "id" : 67,
    "name" : "VMRay Analyze",
    "type" : "UserAction",
    "eventType" : "External",
    "locationLeft" : 590.0,
    "locationTop" : -140.0,
    "httpResponseHeader" : "[]",
    "httpResponseBody" : "Submission was successful. You may view the results at this link.\n\n#App:807:message!String\n\nNote analysis typically takes +5 minutes.",
    "anyOrg" : true,
    "userActionTypes" : "Document",
    "renderBodyAsTip" : true,
    "playbookTriggerFilterList" : [ ],
    "outputVariables" : "[{\"name\":\"trg.action.entity\",\"type\":\"TCEntity\"}]",
    "cacheMinutes" : 120,
    "cacheParams" : "{\"includeMethod\":false,\"includeBody\":false,\"queryParams\":[],\"headerNames\":[]}"
  } ],
  "playbookLabels" : [ {
    "playbookLabelType" : {
      "label" : "Development"
    }
  } ],
  "exportablePipes" : [ ]
}