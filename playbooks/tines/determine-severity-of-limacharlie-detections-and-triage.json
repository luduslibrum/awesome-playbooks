{
  "schema_version": 4,
  "name": "Determine severity of LimaCharlie detections and triage",
  "description": "Apply an open-source set of detection rules to endpoints under LimaCharlie and use Tines to automate the triaging of alerts being generated by these rules.\n\ntags: LimaCharlie, Jira, Slack, Detect, Triage, Alerts, Respond, Notify, Intermediate\nicons: limacharlie, ü©∫, üè•\nvisibility: public",
  "guid": "56079a9021108f613e8e3af47d998355",
  "slug": "determine_severity_of_limacharlie_detections_and_triage",
  "exported_at": "2022-07-11T17:50:51Z",
  "agents": [
    {
      "type": "Agents::WebhookAgent",
      "name": "LimaCharlie Sensor events",
      "disabled": false,
      "guid": "b484f48b3da6fbeaac2e6d2daa6c9bf5",
      "options": {
        "path": "limacharliewebhook",
        "secret": "33576f1f96362d411da92f52f920d029"
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      }
    },
    {
      "type": "Agents::TriggerAgent",
      "name": "Sensor Level High",
      "disabled": false,
      "guid": "3c0f0c5e4cf43166c0d069f1bcd08cb2",
      "options": {
        "rules": [
          {
            "type": "regex",
            "value": "high",
            "path": "<<limacharlie_sensor_events.body.detect_mtd.level>>"
          }
        ]
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      }
    },
    {
      "type": "Agents::TriggerAgent",
      "name": "Sensor Level Medium",
      "disabled": false,
      "guid": "62862e625e89bc838ba3f32c6456fca2",
      "options": {
        "rules": [
          {
            "type": "regex",
            "value": "medium",
            "path": "<<limacharlie_sensor_events.body.detect_mtd.level>>"
          }
        ]
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      }
    },
    {
      "type": "Agents::TriggerAgent",
      "name": "Sensor Level Low",
      "disabled": false,
      "guid": "00d0f29a71aac87a378a0c07ad94aa40",
      "options": {
        "rules": [
          {
            "type": "regex",
            "value": "low",
            "path": "<<limacharlie_sensor_events.body.detect_mtd.level>>"
          }
        ]
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      }
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Create Issue in Jira",
      "disabled": false,
      "guid": "75125c69f59595a4b3a94ada380b9c13",
      "options": {
        "url": "https://<<RESOURCE.jira_domain>>/rest/api/2/issue",
        "content_type": "json",
        "method": "post",
        "payload": {
          "fields": {
            "project": {
              "key": "DEMO"
            },
            "issuetype": {
              "name": "Task"
            },
            "priority": {
              "name": "Highest"
            },
            "description": "h2. Alert Overview:\n\n||*Level*|<<limacharlie_sensor_events.body.detect_mtd.level>> |\n||*Process Name*|<<limacharlie_sensor_events.body.detect.Event.EventData.ProcessName>> |\n||*Provider Name*|<<limacharlie_sensor_events.body.detect.Event.System.Provider.Name>> |\n||*namespace*|<<limacharlie_sensor_events.body.namespace>> |\n||*Log ID*|<<limacharlie_sensor_events.body.routing.log_id>> |\n||*System Time*|<<limacharlie_sensor_events.body.detect.Event.System.TimeCreated.SystemTime>> |\n\n[Click Here to isolate the sensor in LimaCharlie |<<PROMPT(\"contain\")>>]\n",
            "summary": "New LimaCharlie Alert for <<limacharlie_sensor_events.body.cat>>"
          }
        },
        "basic_auth": [
          "<<RESOURCE.jira_username>>",
          "<<CREDENTIAL.jira_demo>>"
        ]
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "schedule": null
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Post Message to a Slack Channel",
      "disabled": false,
      "guid": "b10c30e782d034f5afc099e8d8a4549a",
      "options": {
        "url": "https://<<CREDENTIAL.slack_webhook>>",
        "content_type": "json",
        "method": "post",
        "payload": {
          "text": "<<limacharlie_sensor_events.body.cat>>",
          "blocks": [
            {
              "type": "section",
              "text": {
                "type": "mrkdwn",
                "text": "<<limacharlie_sensor_events.body.detect.event.EVENT.EventData.updateTitle>>"
              }
            },
            {
              "type": "section",
              "fields": [
                {
                  "type": "mrkdwn",
                  "text": "*Computer:* `<<limacharlie_sensor_events.body.detect.event.EVENT.System.Computer>>`"
                },
                {
                  "type": "mrkdwn",
                  "text": "*Level:* `<<limacharlie_sensor_events.body.detect_mtd.level>>`"
                },
                {
                  "type": "mrkdwn",
                  "text": "*Hostname & Ext IP:* `<<limacharlie_sensor_events.body.routing.hostname>>` & `<<limacharlie_sensor_events.body.routing.ext_ip>>`"
                },
                {
                  "type": "mrkdwn",
                  "text": "*Tags:*\n```<<limacharlie_sensor_events.body.detect_mtd.tags>>```"
                }
              ]
            },
            {
              "type": "section",
              "text": {
                "type": "mrkdwn",
                "text": "*Do you want to isolate the sensor?*"
              }
            },
            {
              "type": "actions",
              "elements": [
                {
                  "type": "button",
                  "text": {
                    "type": "plain_text",
                    "emoji": true,
                    "text": "Isolate"
                  },
                  "style": "primary",
                  "url": "<<PROMPT(\"Yes\")>>"
                },
                {
                  "type": "button",
                  "text": {
                    "type": "plain_text",
                    "emoji": true,
                    "text": "Do Not Isolate"
                  },
                  "style": "danger",
                  "url": "<<PROMPT(\"No\")>>"
                }
              ]
            }
          ]
        },
        "headers": {}
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "schedule": null
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "LimaCharlie High",
      "disabled": false,
      "guid": "41f0968c8c59d0257580c21d99fdedc8",
      "options": {
        "url": "https://<<META.tenant.domain>>/webhook/limacharliewebhook/33576f1f96362d411da92f52f920d029",
        "content_type": "json",
        "method": "post",
        "payload": {
          "author": "_sigma",
          "cat": "WMI Event Subscription",
          "detect": {
            "event": {
              "EVENT": {
                "EventData": {
                  "serviceGuid": "{9482f4b4-e343-43b6-b170-9a65bc822c77}",
                  "updateGuid": "{3b862187-65ae-427e-a4fc-73409202ab30}",
                  "updateRevisionNumber": "200",
                  "updateTitle": "Security Intelligence Update for Microsoft Defender Antivirus - KB2267602 (Version 1.355.1773.0)"
                },
                "System": {
                  "Channel": "System",
                  "Computer": "DESKTOP-O24G2A3",
                  "Correlation": "",
                  "EventID": "19",
                  "EventRecordID": "18003",
                  "Execution": {
                    "ProcessID": "8260",
                    "ThreadID": "5604"
                  },
                  "Keywords": "0x8000000000000018",
                  "Level": "4",
                  "Opcode": "13",
                  "Provider": {
                    "Guid": "{945a8954-c147-4acd-923f-40c45405a658}",
                    "Name": "Microsoft-Windows-WindowsUpdateClient"
                  },
                  "Security": {
                    "UserID": "S-1-5-18"
                  },
                  "Task": "1",
                  "TimeCreated": {
                    "SystemTime": "2022-01-12T06:47:08.1745841Z"
                  },
                  "Version": "1"
                }
              }
            },
            "routing": {
              "arch": 2,
              "did": "",
              "event_id": "26e23a82-3674-48c9-8c09-daa5a4e0118b",
              "event_time": 1641970031044,
              "event_type": "WEL",
              "ext_ip": "184.66.91.169",
              "hostname": "DESKTOP-O24G2A3.hitronhub.home",
              "iid": "5f074feb-1127-41b0-920f-cb50dc1f1437",
              "int_ip": "192.168.1.103",
              "moduleid": 2,
              "oid": "8cbe27f4-bfa1-4afb-ba19-138cd51389cd",
              "plat": 268435456,
              "sid": "c159c276-5e69-4deb-8aeb-3c294a6b4361",
              "tags": [
                "test"
              ],
              "this": "7926d542d571b81c0e06f44c61de796f"
            }
          },
          "detect_id": "c6f953f1-b9bf-47d0-ae6a-aab361de796e",
          "detect_mtd": {
            "author": "Tom Ueltschi (@c_APT_ure)",
            "description": "Detects creation of WMI event subscription persistence method",
            "falsepositives": [
              "exclude legitimate (vetted) use of WMI event subscription in your network"
            ],
            "level": "high",
            "tags": [
              "attack.t1084",
              "attack.persistence",
              "attack.t1546.003"
            ]
          },
          "link": "https://app.limacharlie.io/orgs/8cbe27f4-bfa1-4afb-ba19-138cd51389cd/sensors/30701e23-c435-48f3-a41f-3215c63a59f7/timeline?time=1641970031&selected=7926d542d571b81c0e06f44c61de796f",
          "namespace": "general",
          "routing": {
            "arch": 2,
            "did": "",
            "event_id": "26e23a82-3674-48c9-8c09-daa5a4e0118b",
            "event_time": 1641970031044,
            "event_type": "WEL",
            "ext_ip": "184.66.91.169",
            "hostname": "DESKTOP-O24G2A3.hitronhub.home",
            "iid": "5f074feb-1127-41b0-920f-cb50dc1f1437",
            "int_ip": "192.168.1.103",
            "moduleid": 2,
            "oid": "8cbe27f4-bfa1-4afb-ba19-138cd51389cd",
            "plat": 268435456,
            "sid": "c159c276-5e69-4deb-8aeb-3c294a6b4361",
            "tags": [
              "test"
            ],
            "this": "7926d542d571b81c0e06f44c61de796f"
          },
          "source": "8cbe27f4-bfa1-4afb-ba19-138cd51389cd.5f074feb-1127-41b0-920f-cb50dc1f1437.30701e23-c435-48f3-a41f-3215c63a59f7.10000000.2",
          "ts": 1641970030000
        }
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "schedule": null
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "LimaCharlie Medium",
      "disabled": false,
      "guid": "57022c6ac29ba961ff1c9fc3947bca59",
      "options": {
        "url": "https://<<META.tenant.domain>>/webhook/limacharliewebhook/33576f1f96362d411da92f52f920d029",
        "content_type": "json",
        "method": "post",
        "payload": {
          "cat": "VSSAudit Security Event Source Registration",
          "detect": {
            "Event": {
              "EventData": {
                "AuditSourceName": "VSSAudit",
                "EventSourceId": "0x027c0604",
                "ProcessId": "0x000037c8",
                "ProcessName": "C:\\Windows\\System32\\VSSVC.exe",
                "SubjectDomainName": "WORKGROUP",
                "SubjectLogonId": "0x000003e7",
                "SubjectUserName": "TANGO$",
                "SubjectUserSid": "S-1-5-18"
              },
              "System": {
                "Channel": "Security",
                "Computer": "Tango",
                "Correlation": {
                  "ActivityID": "8DAAFC17-0684-0002-6BFC-AA8D8406D801"
                },
                "EventID": "4905",
                "EventRecordID": "523561",
                "Execution": {
                  "ProcessID": "856",
                  "ThreadID": "12884"
                },
                "Keywords": "0x8020000000000000",
                "Level": "0",
                "Opcode": "0",
                "Provider": {
                  "Guid": "54849625-5478-4994-A5BA-3E3B0328C30D",
                  "Name": "Microsoft-Windows-Security-Auditing"
                },
                "Security": {},
                "Task": "13568",
                "TimeCreated": {
                  "SystemTime": "2022-01-12T00:55:45.7768423Z"
                },
                "Version": "0"
              }
            }
          },
          "detect_id": "121ff34a-b0b4-433f-a70d-6206ab6d2d80",
          "detect_mtd": {
            "author": "Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR)",
            "description": "Detects the registration of the security event source VSSAudit. It would usually trigger when volume shadow copy operations happen.",
            "falsepositives": [
              "Legitimate use of VSSVC. Maybe backup operations. It would usually be done by C:\\Windows\\System32\\VSSVC.exe."
            ],
            "level": "medium",
            "references": [
              "https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003.002/T1003.002.md#atomic-test-3---esentutlexe-sam-copy"
            ],
            "tags": [
              "attack.credential_access",
              "attack.t1003.002"
            ]
          },
          "namespace": "general",
          "routing": {
            "event_time": 1641949882000,
            "log_id": "630df087cb8f0c3031cbde3999baf01f",
            "log_type": "wel",
            "oid": "8cbe27f4-bfa1-4afb-ba19-138cd51389cd"
          },
          "source": "992a403a-b082-4b07-a99e-8bac9117635b",
          "ts": 1641949883000
        }
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "schedule": null
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "LimaCharlie Low",
      "disabled": false,
      "guid": "57402b169e2a66a3c26183b622f9a23f",
      "options": {
        "url": "https://<<META.tenant.domain>>/webhook/limacharliewebhook/33576f1f96362d411da92f52f920d029",
        "content_type": "json",
        "method": "post",
        "payload": {
          "author": "_sigma",
          "cat": "Non Interactive PowerShell",
          "detect": {
            "event": {
              "BASE_ADDRESS": 140700948234240,
              "COMMAND_LINE": "powershell.exe -ExecutionPolicy Restricted -Command Write-Host 'Final result: 1';",
              "FILE_IS_SIGNED": 1,
              "FILE_PATH": "C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\powershell.exe",
              "HASH": "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f",
              "MEMORY_USAGE": 6914048,
              "PARENT": {
                "BASE_ADDRESS": 140699616608256,
                "COMMAND_LINE": "\"C:\\$WINDOWS.~BT\\Sources\\SetupHost.Exe\" /PreDownload /Package /Quiet  /ReportId 741A2B36-7B2E-4A86-A9AC-F1664DB4B6DF.1 /FlightData \"RS:DB7F\" \"/CancelId\" \"C-405f6e77-9093-4bb9-b9bf-65ad23a74bc6\" \"/PauseId\" \"P-405f6e77-9093-4bb9-b9bf-65ad23a74bc6\" \"/CorrelationVector\" \"t3w7HzCITk+Id7da.3.1.5.61\" \"/DownloadSizeInMB\" \"0\" ",
                "FILE_IS_SIGNED": 1,
                "FILE_PATH": "C:\\$WINDOWS.~BT\\Sources\\SetupHost.Exe",
                "HASH": "dee91c6734ba3b2b13eb386cb5e81fb66da93785395db2a4f43a45d919967032",
                "MEMORY_USAGE": 8298496,
                "PARENT_ATOM": "41a7fda279373ece3b7c423961de7b40",
                "PARENT_PROCESS_ID": 10668,
                "PROCESS_ID": 8372,
                "THIS_ATOM": "c19443c79d0977a4d06464cc61de7b4a",
                "THREADS": 4,
                "TIMESTAMP": 1641970505965,
                "USER_NAME": "NT AUTHORITY\\SYSTEM"
              },
              "PARENT_PROCESS_ID": 8372,
              "PROCESS_ID": 7412,
              "THREADS": 4,
              "USER_NAME": "NT AUTHORITY\\SYSTEM"
            },
            "routing": {
              "arch": 2,
              "did": "",
              "event_id": "7678f6ce-fe54-4326-9c60-30233dc02879",
              "event_time": 1641970558810,
              "event_type": "NEW_PROCESS",
              "ext_ip": "178.128.238.133",
              "hostname": "Tango",
              "iid": "cad439f2-b9ad-4544-99a0-c0125df43a5c",
              "int_ip": "10.171.213.191",
              "moduleid": 2,
              "oid": "8cbe27f4-bfa1-4afb-ba19-138cd51389cd",
              "parent": "c19443c79d0977a4d06464cc61de7b4a",
              "plat": 268435456,
              "sid": "c159c276-5e69-4deb-8aeb-3c294a6b4361",
              "tags": [
                "ir"
              ],
              "this": "b3246ab95d460c70a49e65d261de7b7f"
            }
          },
          "detect_id": "c1d96c6b-3523-4951-a49b-ebfd61de7b7f",
          "detect_mtd": {
            "author": "Roberto Rodriguez @Cyb3rWard0g (rule), oscd.community (improvements)",
            "description": "Detects non-interactive PowerShell activity by looking at powershell.exe with not explorer.exe as a parent.",
            "falsepositives": [
              "Legitimate programs executing PowerShell scripts"
            ],
            "level": "low",
            "references": [
              "https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190410151110.html"
            ],
            "tags": [
              "attack.execution",
              "attack.t1086",
              "attack.t1059.001"
            ]
          },
          "link": "https://app.limacharlie.io/orgs/8cbe27f4-bfa1-4afb-ba19-138cd51389cd/sensors/992a403a-b082-4b07-a99e-8bac9117635b/timeline?time=1641970558&selected=b3246ab95d460c70a49e65d261de7b7f",
          "namespace": "general",
          "routing": {
            "arch": 2,
            "did": "",
            "event_id": "7678f6ce-fe54-4326-9c60-30233dc02879",
            "event_time": 1641970558810,
            "event_type": "NEW_PROCESS",
            "ext_ip": "178.128.238.133",
            "hostname": "Tango",
            "iid": "cad439f2-b9ad-4544-99a0-c0125df43a5c",
            "int_ip": "10.171.213.191",
            "moduleid": 2,
            "oid": "8cbe27f4-bfa1-4afb-ba19-138cd51389cd",
            "parent": "c19443c79d0977a4d06464cc61de7b4a",
            "plat": 268435456,
            "sid": "c159c276-5e69-4deb-8aeb-3c294a6b4361",
            "tags": [
              "ir"
            ],
            "this": "b3246ab95d460c70a49e65d261de7b7f"
          },
          "source": "8cbe27f4-bfa1-4afb-ba19-138cd51389cd.cad439f2-b9ad-4544-99a0-c0125df43a5c.992a403a-b082-4b07-a99e-8bac9117635b.10000000.2",
          "ts": 1641970559000
        }
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "schedule": null
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Isolate Sensor in LimaCharlie",
      "disabled": false,
      "guid": "262c874f606336c4561485ce2f62c157",
      "options": {
        "url": "https://api.limacharlie.io/v1/<<limacharlie_sensor_events.body.detect.routing.sid>>/isolation",
        "content_type": "json",
        "method": "post",
        "headers": {
          "Authorization": "Bearer <<CREDENTIAL.limacharlie>>"
        }
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "schedule": null
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Create Issue in Jira",
      "disabled": false,
      "guid": "435cae4380af426198bfcf70fe6f997d",
      "options": {
        "url": "https://<<RESOURCE.jira_domain>>/rest/api/2/issue",
        "content_type": "json",
        "method": "post",
        "payload": {
          "fields": {
            "project": {
              "key": "DEMO"
            },
            "issuetype": {
              "name": "Task"
            },
            "priority": {
              "name": "Highest"
            },
            "description": "h2. Alert Overview:\n\n||*Level*|<<limacharlie_sensor_events.body.detect_mtd.level>> |\n||*Process Name*|<<limacharlie_sensor_events.body.detect.Event.EventData.ProcessName>> |\n||*Provider Name*|<<limacharlie_sensor_events.body.detect.Event.System.Provider.Name>> |\n||*namespace*|<<limacharlie_sensor_events.body.namespace>> |\n||*Log ID*|<<limacharlie_sensor_events.body.routing.log_id>> |\n||*System Time*|<<limacharlie_sensor_events.body.detect.Event.System.TimeCreated.SystemTime>> |\n",
            "summary": "New LimaCharlie Alert for <<limacharlie_sensor_events.body.cat>>"
          }
        },
        "basic_auth": [
          "<<RESOURCE.jira_username>>",
          "<<CREDENTIAL.jira_demo>>"
        ]
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "schedule": null
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Add Issue Comment in Jira",
      "disabled": false,
      "guid": "20c99eff7db5b4392dd67157a32e1de2",
      "options": {
        "url": "https://<<RESOURCE.jira_domain>>/rest/api/2/issue/<<create_issue_in_jira.body.key>>/comment/",
        "content_type": "json",
        "method": "post",
        "basic_auth": [
          "<<RESOURCE.jira_username>>",
          "<<CREDENTIAL.jira_demo>>"
        ],
        "payload": {
          "body": "=isolate_sensor_in_limacharlie.body"
        }
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "schedule": null
    },
    {
      "type": "Agents::TriggerAgent",
      "name": "Isolate Sensor",
      "disabled": false,
      "guid": "244ea150853d74fa68802f1c7df106ea",
      "options": {
        "rules": [
          {
            "type": "regex",
            "value": "Yes",
            "path": "<<post_message_to_a_slack_channel.prompt.status>>"
          }
        ]
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      }
    },
    {
      "type": "Agents::TriggerAgent",
      "name": "Do Not Isolate Sensor",
      "disabled": false,
      "guid": "fbc0182d4f34b5c5c28498ee3396433a",
      "options": {
        "rules": [
          {
            "type": "regex",
            "value": "No",
            "path": "<<post_message_to_a_slack_channel.prompt.status>>"
          }
        ]
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      }
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Update Jira to Done",
      "disabled": false,
      "guid": "e86a61747b0a7022db2ee51065eb7e71",
      "options": {
        "url": "https://<<RESOURCE.jira_domain>>/rest/api/2/issue/<<create_issue_in_jira.body.key>>/transitions",
        "content_type": "json",
        "method": "put",
        "basic_auth": [
          "<<RESOURCE.jira_username>>",
          "<<CREDENTIAL.jira_demo>>"
        ],
        "payload": {
          "fields": {
            "status": "<<11>>"
          }
        }
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "schedule": null
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Create Issue in Jira",
      "disabled": false,
      "guid": "36a4e85e93e567a78cd5148b31122ab4",
      "options": {
        "url": "https://<<RESOURCE.jira_domain>>/rest/api/2/issue",
        "content_type": "json",
        "method": "post",
        "payload": {
          "fields": {
            "project": {
              "key": "DEMO"
            },
            "issuetype": {
              "name": "Task"
            },
            "priority": {
              "name": "Highest"
            },
            "description": "h2. Alert Overview:\n\n||*Level*|<<limacharlie_sensor_events.body.detect_mtd.level>> |\n||*Process Name*|<<limacharlie_sensor_events.body.detect.Event.EventData.ProcessName>> |\n||*Provider Name*|<<limacharlie_sensor_events.body.detect.Event.System.Provider.Name>> |\n||*namespace*|<<limacharlie_sensor_events.body.namespace>> |\n||*Log ID*|<<limacharlie_sensor_events.body.routing.log_id>> |\n||*System Time*|<<limacharlie_sensor_events.body.detect.Event.System.TimeCreated.SystemTime>> |\n\n[Click Here to isolate the sensor in LimaCharlie |<<PROMPT(\"contain\")>>]\n",
            "summary": "New LimaCharlie Alert for <<limacharlie_sensor_events.body.cat>>"
          }
        },
        "basic_auth": [
          "<<RESOURCE.jira_username>>",
          "<<CREDENTIAL.jira_demo>>"
        ]
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "schedule": null
    },
    {
      "type": "Agents::TriggerAgent",
      "name": "Trigger if Field has Hash",
      "disabled": false,
      "guid": "04665ad80cb85c06e44320cb81383a12",
      "options": {
        "rules": [
          {
            "type": "regex",
            "path": "<<limacharlie_sensor_events.body.detect.event.HASH>>",
            "value": ".+"
          }
        ]
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      }
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Search for File Hash in VirusTotal",
      "disabled": false,
      "guid": "b25a9c17891647368bdebcc5d94b20f2",
      "options": {
        "url": "https://www.virustotal.com/api/v3/files/<<limacharlie_sensor_events.body.detect.event.HASH>>",
        "content_type": "json",
        "method": "get",
        "headers": {
          "x-apikey": "<<CREDENTIAL.virustotal>>"
        },
        "retry_on_status": [
          "429"
        ]
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "schedule": null
    },
    {
      "type": "Agents::TriggerAgent",
      "name": "Trigger if Field Matches Null Regex",
      "disabled": false,
      "guid": "c411635c1c2ca367c54a6c7c8d70ac55",
      "options": {
        "rules": [
          {
            "type": "regex",
            "path": "<<limacharlie_sensor_events.body.detect.event.HASH>>",
            "value": "^$"
          }
        ]
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      }
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Add Issue Comment in Jira",
      "disabled": false,
      "guid": "d241fd01e2aa313dbff1121b54d531d5",
      "options": {
        "url": "https://<<RESOURCE.jira_domain>>/rest/api/2/issue/<<create_issue_in_jira.body.key>>/comment/",
        "content_type": "json",
        "method": "post",
        "basic_auth": [
          "<<RESOURCE.jira_username>>",
          "<<CREDENTIAL.jira_demo>>"
        ],
        "payload": {
          "body": "||*Process Hash*|<<limacharlie_sensor_events.body.detect.event.HASH>> |\n||*Signature Info*|<<search_for_file_hash_in_virustotal.body.data.attributes.crowdsourced_ids_results.first.rule_category>> |\n||*IDS Rule Message*|<<search_for_file_hash_in_virustotal.body.data.attributes.crowdsourced_ids_results.first.rule_msg>> |\n||*Rule References*|<<search_for_file_hash_in_virustotal.body.data.attributes.crowdsourced_ids_results.first.rule_references>> |\n||*IOC Source*|<<search_for_file_hash_in_virustotal.body.data.attributes.crowdsourced_ids_results.first.rule_source>> |"
        }
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "schedule": null
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Create Issue in Jira",
      "disabled": false,
      "guid": "e636a0c177a86b6824420a511259a305",
      "options": {
        "url": "https://<<RESOURCE.jira_domain>>/rest/api/2/issue",
        "content_type": "json",
        "method": "post",
        "payload": {
          "fields": {
            "project": {
              "key": "DEMO"
            },
            "issuetype": {
              "name": "Task"
            },
            "priority": {
              "name": "Highest"
            },
            "description": "h2. Alert Overview:\n\n||*Level*|<<limacharlie_sensor_events.body.detect_mtd.level>> |\n||*Process Name*|<<limacharlie_sensor_events.body.detect.event.EVENT.EventData.updateTitle>> |\n||*Provider Name*|<<limacharlie_sensor_events.body.cat>> |\n||*Computer*|<<limacharlie_sensor_events.body.detect.event.EVENT.System.Computer>> |\n||*Event Record ID*|<<limacharlie_sensor_events.body.detect.event.EVENT.System.EventRecordID>> |\n||*System Time*|<<limacharlie_sensor_events.body.detect.event.EVENT.System.TimeCreated.SystemTime>> |\n||*EXT IP*| <<limacharlie_sensor_events.body.detect.routing.ext_ip>>\n\n[Click Here to isolate the sensor in LimaCharlie |<<PROMPT(\"contain\")>>]\n",
            "summary": "New LimaCharlie Alert for <<limacharlie_sensor_events.body.cat>>"
          }
        },
        "basic_auth": [
          "<<RESOURCE.jira_username>>",
          "<<CREDENTIAL.jira_demo>>"
        ]
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "schedule": null
    }
  ],
  "diagram_notes": [
    {
      "content": "https://lyticalventures.com/wp-content/uploads/2020/08/logo_w_text-horizontal.png",
      "position": [
        225.0,
        -30.0
      ],
      "guid": "ec5da022f072cec234d88d9b8e4e772a",
      "width": null
    },
    {
      "content": "# Story Configuration\n\n**LimaCharlie**\n- [ ] [Sign-up for LimaCharlie](https://app.limacharlie.io/signup) Account\n- [ ] [LimaCharlie API docs](https://doc.limacharlie.io/docs/documentation/ZG9jOjI5NTIzMTM4-overview) to generate your API token\n\n**Tines**\n- [ ] Add LimaCharlie as an HTTP Request Credential in Tines\n`{\n  \"url\": \"https://app.limacharlie.io/jwt\",\n  \"method\": \"get\",\n  \"payload\": {\n    \"oid\": \"add-your-organizationID\",\n    \"secret\": \"add-your-APIkey\"\n  }\n}`\n- [ ] Create a credential for your ticketing tool\n- [ ] Create an incoming webhook for Slack\n- [ ] Create a VirusTotal API key (*Not Required*)",
      "position": [
        -93.0,
        -226.0
      ],
      "guid": "0565c7590cb80c8cc8958a5185914242",
      "width": null
    }
  ],
  "links": [
    {
      "source": 0,
      "receiver": 3
    },
    {
      "source": 0,
      "receiver": 2
    },
    {
      "source": 0,
      "receiver": 1
    },
    {
      "source": 1,
      "receiver": 5
    },
    {
      "source": 2,
      "receiver": 4
    },
    {
      "source": 3,
      "receiver": 15
    },
    {
      "source": 5,
      "receiver": 12
    },
    {
      "source": 5,
      "receiver": 13
    },
    {
      "source": 9,
      "receiver": 10
    },
    {
      "source": 10,
      "receiver": 11
    },
    {
      "source": 12,
      "receiver": 9
    },
    {
      "source": 13,
      "receiver": 20
    },
    {
      "source": 15,
      "receiver": 18
    },
    {
      "source": 15,
      "receiver": 16
    },
    {
      "source": 16,
      "receiver": 17
    },
    {
      "source": 17,
      "receiver": 19
    },
    {
      "source": 18,
      "receiver": 14
    }
  ],
  "diagram_layout": "{\"b484f48b3da6fbeaac2e6d2daa6c9bf5\":[390,195],\"3c0f0c5e4cf43166c0d069f1bcd08cb2\":[150,270],\"62862e625e89bc838ba3f32c6456fca2\":[390,270],\"00d0f29a71aac87a378a0c07ad94aa40\":[615,270],\"75125c69f59595a4b3a94ada380b9c13\":[390,345],\"b10c30e782d034f5afc099e8d8a4549a\":[150,360],\"41f0968c8c59d0257580c21d99fdedc8\":[210,-285],\"57022c6ac29ba961ff1c9fc3947bca59\":[210,-210],\"57402b169e2a66a3c26183b622f9a23f\":[210,-135],\"262c874f606336c4561485ce2f62c157\":[-60,540],\"435cae4380af426198bfcf70fe6f997d\":[-60,630],\"20c99eff7db5b4392dd67157a32e1de2\":[-60,720],\"244ea150853d74fa68802f1c7df106ea\":[-60,450],\"fbc0182d4f34b5c5c28498ee3396433a\":[210,450],\"e86a61747b0a7022db2ee51065eb7e71\":[615,510],\"36a4e85e93e567a78cd5148b31122ab4\":[615,345],\"04665ad80cb85c06e44320cb81383a12\":[855,420],\"b25a9c17891647368bdebcc5d94b20f2\":[855,510],\"c411635c1c2ca367c54a6c7c8d70ac55\":[615,420],\"d241fd01e2aa313dbff1121b54d531d5\":[855,615],\"e636a0c177a86b6824420a511259a305\":[210,525]}",
  "send_to_story_enabled": false,
  "entry_agent_guid": null,
  "exit_agent_guids": [],
  "exit_agent_guid": null,
  "send_to_stories": [],
  "form": {
    "name": "Determine severity of LimaCharlie detections and triage Form",
    "description": "",
    "fields": [],
    "visibility": "tenant",
    "agent_guid": null,
    "success_message": "Thank you for your submission"
  }
}